{"version":3,"sources":["./src/app/bookings/bookings.page.html","./src/app/bookings/booking.model.ts","./src/app/bookings/booking.service.ts","./src/app/bookings/bookings-routing.module.ts","./src/app/bookings/bookings.module.ts","./src/app/bookings/bookings.page.scss","./src/app/bookings/bookings.page.ts"],"names":[],"mappings":"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","file":"bookings-bookings-module.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-buttons>\\n      <ion-menu-button menu=\\\"m1\\\"></ion-menu-button>\\n    </ion-buttons>\\n    <ion-title>Your Bookings</ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content>\\n  <ion-grid>\\n    <ion-row>\\n      <ion-col size-md=\\\"8\\\" offset-md=\\\"2\\\" *ngIf=\\\"isLoading\\\" class=\\\"ion-text-center\\\">\\n        <ion-spinner color=\\\"primary\\\"></ion-spinner>\\n      </ion-col>\\n      <ion-col size-md=\\\"8\\\" offset-md=\\\"2\\\" *ngIf=\\\"!isLoading && (!loadedBookings || loadedBookings.length == 0)\\\" class=\\\"ion-text-center\\\">\\n        <p> No bookings found !!!</p>\\n      </ion-col>\\n      <ion-col size-md=\\\"8\\\" offset-md=\\\"2\\\" *ngIf=\\\"!isLoading && loadedBookings && loadedBookings.length > 0\\\">\\n        <ion-list>\\n          <ion-item-sliding *ngFor=\\\"let booking of loadedBookings\\\" #slidingBooking>\\n            <ion-item>\\n              <ion-avatar slot=\\\"start\\\">\\n                <ion-img [src]=\\\"booking.placeImage\\\"></ion-img>\\n              </ion-avatar>\\n              <ion-label>\\n                <h5> {{ booking.placeTitle}}</h5>\\n                <p> Guests: {{ booking.guestNumber }}</p>\\n              </ion-label>\\n            </ion-item>\\n            <ion-item-options>\\n              <ion-item-option color=\\\"danger\\\" (click)=\\\"onCancelBooking(booking.id, slidingBooking)\\\">\\n                <ion-icon name=\\\"trash\\\" slot=\\\"icon-only\\\"></ion-icon>\\n              </ion-item-option>\\n            </ion-item-options>\\n          </ion-item-sliding>\\n        </ion-list>\\n      </ion-col>\\n    </ion-row>\\n  </ion-grid>\\n  \\n</ion-content>\\n\"","export class Booking {\n  constructor(\n    public id: string,\n    public placeId: string,\n    public userId: string,\n    public placeTitle: string,\n    public placeImage: string,\n    public firstName: string,\n    public lastName: string,\n    public guestNumber: number,\n    public bookedFrom: Date,\n    public bookedTo: Date\n  ) {}\n}\n","import { Injectable } from \"@angular/core\";\nimport { Booking } from \"./booking.model\";\nimport { BehaviorSubject } from \"rxjs\";\nimport { AuthService } from \"../auth/auth.service\";\nimport { take, delay, tap, map, switchMap } from \"rxjs/operators\";\nimport { HttpClient } from \"@angular/common/http\";\n\ninterface BookingData {\n  bookedFrom: string;\n  bookedTo: string;\n  firstName: string;\n  lastName: string;\n  guestNumber: number;\n  placeId: string;\n  placeImage: string;\n  placeTitle: string;\n  userId: string;\n}\n@Injectable({ providedIn: \"root\" })\nexport class BookingService {\n  private _bookings = new BehaviorSubject<Booking[]>([]);\n  constructor(private authService: AuthService, private http: HttpClient) {}\n  get bookings() {\n    return this._bookings.asObservable();\n  }\n  getBooking(id: string) {\n    return this.bookings.pipe(\n      take(1),\n      map(bookings => {\n        return { ...bookings.find(b => b.id === id) };\n      })\n    );\n  }\n\n  fetchBookings() {\n    return this.http\n      .get<{ [key: string]: BookingData }>(\n        `https://ionic-angular-course-b1b7f.firebaseio.com/bookings.json?orderBy=\"userId\"&equalTo=\"${this.authService.userId}\"`\n      )\n      .pipe(\n        map(bookingData => {\n          const bookings = [];\n          for (const key in bookingData) {\n            if (bookingData.hasOwnProperty(key)) {\n              const data = bookingData[key];\n              bookings.push(\n                new Booking(\n                  key,\n                  data.placeId,\n                  data.userId,\n                  data.placeTitle,\n                  data.placeImage,\n                  data.firstName,\n                  data.lastName,\n                  data.guestNumber,\n                  new Date(data.bookedFrom),\n                  new Date(data.bookedTo)\n                )\n              );\n            }\n          }\n          return bookings;\n        }),\n        tap(bookings => {\n          this._bookings.next(bookings);\n        })\n      );\n  }\n\n  addBooking(\n    placeId: string,\n    placeTitle: string,\n    placeImage: string,\n    firstName: string,\n    lastName: string,\n    guestNumber: number,\n    dateFrom: Date,\n    dateTo: Date\n  ) {\n    let generatedId: string;\n    const newBooking = new Booking(\n      Math.random().toString(),\n      placeId,\n      this.authService.userId,\n      placeTitle,\n      placeImage,\n      firstName,\n      lastName,\n      guestNumber,\n      dateFrom,\n      dateTo\n    );\n    return this.http\n      .post<{ name: string }>(\n        \"https://ionic-angular-course-b1b7f.firebaseio.com/bookings.json\",\n        { ...newBooking, id: null }\n      )\n      .pipe(\n        switchMap(resData => {\n          generatedId = resData.name;\n          return this.bookings;\n        }),\n        take(1),\n        tap(bookings => {\n          newBooking.id = generatedId;\n          return this._bookings.next(bookings.concat(newBooking));\n        })\n      );\n  }\n\n  cancelBooking(bookingId: string) {\n    return this.http.delete(`https://ionic-angular-course-b1b7f.firebaseio.com/bookings/${bookingId}.json`)\n    .pipe(\n      switchMap(() => {\n        return this.bookings;\n      }),\n      take(1),\n      tap(bookings => {\n        this._bookings.next(bookings.filter(b => b.id !== bookingId));\n      })\n    );\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { BookingsPage } from './bookings.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: BookingsPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class BookingsPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { BookingsPageRoutingModule } from './bookings-routing.module';\n\nimport { BookingsPage } from './bookings.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    BookingsPageRoutingModule\n  ],\n  declarations: [BookingsPage]\n})\nexport class BookingsPageModule {}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL2Jvb2tpbmdzL2Jvb2tpbmdzLnBhZ2Uuc2NzcyJ9 */\"","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { IonItemSliding, LoadingController } from '@ionic/angular';\n\nimport { BookingService } from './booking.service';\nimport { Booking } from './booking.model';\nimport { Subscription } from 'rxjs';\n\n\n@Component({\n  selector: 'app-bookings',\n  templateUrl: './bookings.page.html',\n  styleUrls: ['./bookings.page.scss'],\n})\nexport class BookingsPage implements OnInit, OnDestroy {\n loadedBookings: Booking[];\n isLoading = false;\n private bookingSub: Subscription;\n constructor(private bookingService: BookingService, private loadingCtrl: LoadingController) { }\n\n  ngOnInit() {\n    this.bookingSub = this.bookingService.bookings.subscribe(bookings => {\n      this.loadedBookings = bookings;\n    });\n  }\n\n  ionViewWillEnter() {\n    this.isLoading = true;\n    this.bookingService.fetchBookings().subscribe(() => {\n      this.isLoading =  false;\n    });\n  }\n  onCancelBooking(bookingId: string, slidingEl: IonItemSliding) {\n    slidingEl.close();\n    console.log(\"cancel booking with id:\", bookingId);\n    this.loadingCtrl.create({message: 'Cancelling..'}).then( loadingEl => {\n      loadingEl.present();\n      this.bookingService.cancelBooking(bookingId).subscribe(() => loadingEl.dismiss());\n    });\n  }\n\n  ngOnDestroy() {\n    if (this.bookingSub) {\n      this.bookingSub.unsubscribe();\n    }\n  }\n\n}\n"],"sourceRoot":"webpack:///"}